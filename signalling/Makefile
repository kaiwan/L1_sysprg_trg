# Makefile
#----------------------------------------------------------------------
#  Generated by the genmk.sh utility.
#
#  ASSUMPTIONS ::
#   1. the convenience files ../common.h and ../common.c
#      are present
#   3. the clang/LLVM compiler is installed.
#
#  (c) Kaiwan NB, kaiwanTECH
#  License: MIT
#----------------------------------------------------------------------

## Pl check and keep or remove <foo>_dbg_[asan|ub|msan] targets
## as desired.
ALL :=  catchall sig1 sig1_dbg sig1_dbg_asan sig1_dbg_ub sig1_dbg_msan \
	sig1_unsafe sig1_unsafe_dbg_tsan \
	zombies_clear_traditional zombies_clear_traditional_dbg zombies_clear_traditional_dbg_asan zombies_clear_traditional_dbg_ub zombies_clear_traditional_dbg_msan \
	zombies_clear_linux26 zombies_clear_linux26_dbg zombies_clear_linux26_dbg_asan zombies_clear_linux26_dbg_ub zombies_clear_linux26_dbg_msan \
	sigcrit sigcrit_dbg sigcrit_dbg_asan sigcrit_dbg_ub sigcrit_dbg_msan \
	sanodef sanodef_dbg sanodef_dbg_asan sanodef_dbg_ub sanodef_dbg_msan \
	nano nano_dbg nano_dbg_asan nano_dbg_ub nano_dbg_msan \
	killer killer_dbg killer_dbg_asan killer_dbg_ub killer_dbg_msan \
	handle_segv handle_segv_dbg handle_segv_dbg_asan handle_segv_dbg_ub handle_segv_dbg_msan \

CC=${CROSS_COMPILE}gcc
CL=${CROSS_COMPILE}clang

CFLAGS=-Wall -UDEBUG
CFLAGS_DBG=-g -ggdb -gdwarf-4 -O0 -Wall -Wextra -DDEBUG
CFLAGS_DBG_ASAN=${CFLAGS_DBG} -fsanitize=address
CFLAGS_DBG_MSAN=${CFLAGS_DBG} -fsanitize=memory
CFLAGS_DBG_UB=${CFLAGS_DBG} -fsanitize=undefined

all: ${ALL}
CB_FILES := *.[ch]

common.o: ../common.c ../common.h
	${CC} ${CFLAGS} -c ../common.c -o common.o
common_dbg.o: ../common.c ../common.h
	${CC} ${CFLAGS_DBG} -c ../common.c -o common_dbg.o

#--- Sanitizers (use clang): common_dbg_*
common_dbg_asan.o: ../common.c ../common.h
	${CL} ${CFLAGS_DBG_ASAN} -c ../common.c -o common_dbg_asan.o
common_dbg_ub.o: ../common.c ../common.h
	${CL} ${CFLAGS_DBG_UB} -c ../common.c -o common_dbg_ub.o
common_dbg_msan.o: ../common.c ../common.h
	${CL} ${CFLAGS_DBG_MSAN} -c ../common.c -o common_dbg_msan.o

catchall.o: catchall.c
	${CC} ${CFLAGS} -c catchall.c -o catchall.o
catchall: common.o catchall.o
	${CC} ${CFLAGS} -o catchall catchall.o common.o

sig1.o: sig1.c
	${CC} ${CFLAGS} -c sig1.c -o sig1.o
sig1: common.o sig1.o
	${CC} ${CFLAGS} -o sig1 sig1.o common.o

sig1_dbg.o: sig1.c
	${CC} ${CFLAGS_DBG} -c sig1.c -o sig1_dbg.o
sig1_dbg: sig1_dbg.o common_dbg.o
	${CC} ${CFLAGS_DBG} -o sig1_dbg sig1_dbg.o common_dbg.o

#--- Sanitizers (use clang): <foo>_dbg_[asan|ub|msan]
sig1_dbg_asan.o: sig1.c
	${CL} ${CFLAGS_DBG_ASAN} -c sig1.c -o sig1_dbg_asan.o
sig1_dbg_asan: sig1_dbg_asan.o common_dbg_asan.o
	${CL} ${CFLAGS_DBG_ASAN} -o sig1_dbg_asan sig1_dbg_asan.o common_dbg_asan.o

sig1_unsafe_dbg_tsan: sig1_unsafe.c
	${CC} ${CFLAGS_DBG} -fsanitize=thread sig1_unsafe.c -o sig1_unsafe_dbg_tsan

sig1_dbg_ub.o: sig1.c
	${CL} ${CFLAGS_DBG_UB} -c sig1.c -o sig1_dbg_ub.o
sig1_dbg_ub: sig1_dbg_ub.o common_dbg_ub.o
	${CL} ${CFLAGS_DBG_UB} -o sig1_dbg_ub sig1_dbg_ub.o common_dbg_ub.o

sig1_dbg_msan.o: sig1.c
	${CL} ${CFLAGS_DBG_MSAN} -c sig1.c -o sig1_dbg_msan.o
sig1_dbg_msan: sig1_dbg_msan.o common_dbg_msan.o
	${CL} ${CFLAGS_DBG_MSAN} -o sig1_dbg_msan sig1_dbg_msan.o common_dbg_msan.o

zombies_clear_traditional.o: zombies_clear_traditional.c
	${CC} ${CFLAGS} -c zombies_clear_traditional.c -o zombies_clear_traditional.o
zombies_clear_traditional: common.o zombies_clear_traditional.o
	${CC} ${CFLAGS} -o zombies_clear_traditional zombies_clear_traditional.o common.o

zombies_clear_traditional_dbg.o: zombies_clear_traditional.c
	${CC} ${CFLAGS_DBG} -c zombies_clear_traditional.c -o zombies_clear_traditional_dbg.o
zombies_clear_traditional_dbg: zombies_clear_traditional_dbg.o common_dbg.o
	${CC} ${CFLAGS_DBG} -o zombies_clear_traditional_dbg zombies_clear_traditional_dbg.o common_dbg.o

#--- Sanitizers (use clang): <foo>_dbg_[asan|ub|msan]
zombies_clear_traditional_dbg_asan.o: zombies_clear_traditional.c
	${CL} ${CFLAGS_DBG_ASAN} -c zombies_clear_traditional.c -o zombies_clear_traditional_dbg_asan.o
zombies_clear_traditional_dbg_asan: zombies_clear_traditional_dbg_asan.o common_dbg_asan.o
	${CL} ${CFLAGS_DBG_ASAN} -o zombies_clear_traditional_dbg_asan zombies_clear_traditional_dbg_asan.o common_dbg_asan.o

zombies_clear_traditional_dbg_ub.o: zombies_clear_traditional.c
	${CL} ${CFLAGS_DBG_UB} -c zombies_clear_traditional.c -o zombies_clear_traditional_dbg_ub.o
zombies_clear_traditional_dbg_ub: zombies_clear_traditional_dbg_ub.o common_dbg_ub.o
	${CL} ${CFLAGS_DBG_UB} -o zombies_clear_traditional_dbg_ub zombies_clear_traditional_dbg_ub.o common_dbg_ub.o

zombies_clear_traditional_dbg_msan.o: zombies_clear_traditional.c
	${CL} ${CFLAGS_DBG_MSAN} -c zombies_clear_traditional.c -o zombies_clear_traditional_dbg_msan.o
zombies_clear_traditional_dbg_msan: zombies_clear_traditional_dbg_msan.o common_dbg_msan.o
	${CL} ${CFLAGS_DBG_MSAN} -o zombies_clear_traditional_dbg_msan zombies_clear_traditional_dbg_msan.o common_dbg_msan.o

zombies_clear_linux26.o: zombies_clear_linux26.c
	${CC} ${CFLAGS} -c zombies_clear_linux26.c -o zombies_clear_linux26.o
zombies_clear_linux26: common.o zombies_clear_linux26.o
	${CC} ${CFLAGS} -o zombies_clear_linux26 zombies_clear_linux26.o common.o

zombies_clear_linux26_dbg.o: zombies_clear_linux26.c
	${CC} ${CFLAGS_DBG} -c zombies_clear_linux26.c -o zombies_clear_linux26_dbg.o
zombies_clear_linux26_dbg: zombies_clear_linux26_dbg.o common_dbg.o
	${CC} ${CFLAGS_DBG} -o zombies_clear_linux26_dbg zombies_clear_linux26_dbg.o common_dbg.o

#--- Sanitizers (use clang): <foo>_dbg_[asan|ub|msan]
zombies_clear_linux26_dbg_asan.o: zombies_clear_linux26.c
	${CL} ${CFLAGS_DBG_ASAN} -c zombies_clear_linux26.c -o zombies_clear_linux26_dbg_asan.o
zombies_clear_linux26_dbg_asan: zombies_clear_linux26_dbg_asan.o common_dbg_asan.o
	${CL} ${CFLAGS_DBG_ASAN} -o zombies_clear_linux26_dbg_asan zombies_clear_linux26_dbg_asan.o common_dbg_asan.o

zombies_clear_linux26_dbg_ub.o: zombies_clear_linux26.c
	${CL} ${CFLAGS_DBG_UB} -c zombies_clear_linux26.c -o zombies_clear_linux26_dbg_ub.o
zombies_clear_linux26_dbg_ub: zombies_clear_linux26_dbg_ub.o common_dbg_ub.o
	${CL} ${CFLAGS_DBG_UB} -o zombies_clear_linux26_dbg_ub zombies_clear_linux26_dbg_ub.o common_dbg_ub.o

zombies_clear_linux26_dbg_msan.o: zombies_clear_linux26.c
	${CL} ${CFLAGS_DBG_MSAN} -c zombies_clear_linux26.c -o zombies_clear_linux26_dbg_msan.o
zombies_clear_linux26_dbg_msan: zombies_clear_linux26_dbg_msan.o common_dbg_msan.o
	${CL} ${CFLAGS_DBG_MSAN} -o zombies_clear_linux26_dbg_msan zombies_clear_linux26_dbg_msan.o common_dbg_msan.o

sigcrit.o: sigcrit.c
	${CC} ${CFLAGS} -c sigcrit.c -o sigcrit.o
sigcrit: common.o sigcrit.o
	${CC} ${CFLAGS} -o sigcrit sigcrit.o common.o

sigcrit_dbg.o: sigcrit.c
	${CC} ${CFLAGS_DBG} -c sigcrit.c -o sigcrit_dbg.o
sigcrit_dbg: sigcrit_dbg.o common_dbg.o
	${CC} ${CFLAGS_DBG} -o sigcrit_dbg sigcrit_dbg.o common_dbg.o

#--- Sanitizers (use clang): <foo>_dbg_[asan|ub|msan]
sigcrit_dbg_asan.o: sigcrit.c
	${CL} ${CFLAGS_DBG_ASAN} -c sigcrit.c -o sigcrit_dbg_asan.o
sigcrit_dbg_asan: sigcrit_dbg_asan.o common_dbg_asan.o
	${CL} ${CFLAGS_DBG_ASAN} -o sigcrit_dbg_asan sigcrit_dbg_asan.o common_dbg_asan.o

sigcrit_dbg_ub.o: sigcrit.c
	${CL} ${CFLAGS_DBG_UB} -c sigcrit.c -o sigcrit_dbg_ub.o
sigcrit_dbg_ub: sigcrit_dbg_ub.o common_dbg_ub.o
	${CL} ${CFLAGS_DBG_UB} -o sigcrit_dbg_ub sigcrit_dbg_ub.o common_dbg_ub.o

sigcrit_dbg_msan.o: sigcrit.c
	${CL} ${CFLAGS_DBG_MSAN} -c sigcrit.c -o sigcrit_dbg_msan.o
sigcrit_dbg_msan: sigcrit_dbg_msan.o common_dbg_msan.o
	${CL} ${CFLAGS_DBG_MSAN} -o sigcrit_dbg_msan sigcrit_dbg_msan.o common_dbg_msan.o

sanodef.o: sanodef.c
	${CC} ${CFLAGS} -c sanodef.c -o sanodef.o
sanodef: common.o sanodef.o
	${CC} ${CFLAGS} -o sanodef sanodef.o common.o

sanodef_dbg.o: sanodef.c
	${CC} ${CFLAGS_DBG} -c sanodef.c -o sanodef_dbg.o
sanodef_dbg: sanodef_dbg.o common_dbg.o
	${CC} ${CFLAGS_DBG} -o sanodef_dbg sanodef_dbg.o common_dbg.o

#--- Sanitizers (use clang): <foo>_dbg_[asan|ub|msan]
sanodef_dbg_asan.o: sanodef.c
	${CL} ${CFLAGS_DBG_ASAN} -c sanodef.c -o sanodef_dbg_asan.o
sanodef_dbg_asan: sanodef_dbg_asan.o common_dbg_asan.o
	${CL} ${CFLAGS_DBG_ASAN} -o sanodef_dbg_asan sanodef_dbg_asan.o common_dbg_asan.o

sanodef_dbg_ub.o: sanodef.c
	${CL} ${CFLAGS_DBG_UB} -c sanodef.c -o sanodef_dbg_ub.o
sanodef_dbg_ub: sanodef_dbg_ub.o common_dbg_ub.o
	${CL} ${CFLAGS_DBG_UB} -o sanodef_dbg_ub sanodef_dbg_ub.o common_dbg_ub.o

sanodef_dbg_msan.o: sanodef.c
	${CL} ${CFLAGS_DBG_MSAN} -c sanodef.c -o sanodef_dbg_msan.o
sanodef_dbg_msan: sanodef_dbg_msan.o common_dbg_msan.o
	${CL} ${CFLAGS_DBG_MSAN} -o sanodef_dbg_msan sanodef_dbg_msan.o common_dbg_msan.o

nano.o: nano.c
	${CC} ${CFLAGS} -c nano.c -o nano.o
nano: common.o nano.o
	${CC} ${CFLAGS} -o nano nano.o common.o

nano_dbg.o: nano.c
	${CC} ${CFLAGS_DBG} -c nano.c -o nano_dbg.o
nano_dbg: nano_dbg.o common_dbg.o
	${CC} ${CFLAGS_DBG} -o nano_dbg nano_dbg.o common_dbg.o

#--- Sanitizers (use clang): <foo>_dbg_[asan|ub|msan]
nano_dbg_asan.o: nano.c
	${CL} ${CFLAGS_DBG_ASAN} -c nano.c -o nano_dbg_asan.o
nano_dbg_asan: nano_dbg_asan.o common_dbg_asan.o
	${CL} ${CFLAGS_DBG_ASAN} -o nano_dbg_asan nano_dbg_asan.o common_dbg_asan.o

nano_dbg_ub.o: nano.c
	${CL} ${CFLAGS_DBG_UB} -c nano.c -o nano_dbg_ub.o
nano_dbg_ub: nano_dbg_ub.o common_dbg_ub.o
	${CL} ${CFLAGS_DBG_UB} -o nano_dbg_ub nano_dbg_ub.o common_dbg_ub.o

nano_dbg_msan.o: nano.c
	${CL} ${CFLAGS_DBG_MSAN} -c nano.c -o nano_dbg_msan.o
nano_dbg_msan: nano_dbg_msan.o common_dbg_msan.o
	${CL} ${CFLAGS_DBG_MSAN} -o nano_dbg_msan nano_dbg_msan.o common_dbg_msan.o

killer.o: killer.c
	${CC} ${CFLAGS} -c killer.c -o killer.o
killer: common.o killer.o
	${CC} ${CFLAGS} -o killer killer.o common.o

killer_dbg.o: killer.c
	${CC} ${CFLAGS_DBG} -c killer.c -o killer_dbg.o
killer_dbg: killer_dbg.o common_dbg.o
	${CC} ${CFLAGS_DBG} -o killer_dbg killer_dbg.o common_dbg.o

#--- Sanitizers (use clang): <foo>_dbg_[asan|ub|msan]
killer_dbg_asan.o: killer.c
	${CL} ${CFLAGS_DBG_ASAN} -c killer.c -o killer_dbg_asan.o
killer_dbg_asan: killer_dbg_asan.o common_dbg_asan.o
	${CL} ${CFLAGS_DBG_ASAN} -o killer_dbg_asan killer_dbg_asan.o common_dbg_asan.o

killer_dbg_ub.o: killer.c
	${CL} ${CFLAGS_DBG_UB} -c killer.c -o killer_dbg_ub.o
killer_dbg_ub: killer_dbg_ub.o common_dbg_ub.o
	${CL} ${CFLAGS_DBG_UB} -o killer_dbg_ub killer_dbg_ub.o common_dbg_ub.o

killer_dbg_msan.o: killer.c
	${CL} ${CFLAGS_DBG_MSAN} -c killer.c -o killer_dbg_msan.o
killer_dbg_msan: killer_dbg_msan.o common_dbg_msan.o
	${CL} ${CFLAGS_DBG_MSAN} -o killer_dbg_msan killer_dbg_msan.o common_dbg_msan.o

handle_segv.o: handle_segv.c
	${CC} ${CFLAGS} -c handle_segv.c -o handle_segv.o
handle_segv: common.o handle_segv.o
	${CC} ${CFLAGS} -o handle_segv handle_segv.o common.o

handle_segv_dbg.o: handle_segv.c
	${CC} ${CFLAGS_DBG} -c handle_segv.c -o handle_segv_dbg.o
handle_segv_dbg: handle_segv_dbg.o common_dbg.o
	${CC} ${CFLAGS_DBG} -o handle_segv_dbg handle_segv_dbg.o common_dbg.o

#--- Sanitizers (use clang): <foo>_dbg_[asan|ub|msan]
handle_segv_dbg_asan.o: handle_segv.c
	${CL} ${CFLAGS_DBG_ASAN} -c handle_segv.c -o handle_segv_dbg_asan.o
handle_segv_dbg_asan: handle_segv_dbg_asan.o common_dbg_asan.o
	${CL} ${CFLAGS_DBG_ASAN} -o handle_segv_dbg_asan handle_segv_dbg_asan.o common_dbg_asan.o

handle_segv_dbg_ub.o: handle_segv.c
	${CL} ${CFLAGS_DBG_UB} -c handle_segv.c -o handle_segv_dbg_ub.o
handle_segv_dbg_ub: handle_segv_dbg_ub.o common_dbg_ub.o
	${CL} ${CFLAGS_DBG_UB} -o handle_segv_dbg_ub handle_segv_dbg_ub.o common_dbg_ub.o

handle_segv_dbg_msan.o: handle_segv.c
	${CL} ${CFLAGS_DBG_MSAN} -c handle_segv.c -o handle_segv_dbg_msan.o
handle_segv_dbg_msan: handle_segv_dbg_msan.o common_dbg_msan.o
	${CL} ${CFLAGS_DBG_MSAN} -o handle_segv_dbg_msan handle_segv_dbg_msan.o common_dbg_msan.o

# indent- "beautifies" C code into the "Linux kernel style".
# (cb = C Beautifier :) )
# Note! original source file(s) is overwritten, so we back it up.
cb: ${CB_FILES}
	mkdir bkp 2> /dev/null; cp -f ${CB_FILES} bkp/
	indent -linux ${CB_FILES}

clean:
	rm -vf ${ALL} core* vgcore* *.o *~
